<% include ../partials/header %>

	<div class="w-100 mt-3" id="searchandfilters">
		<div class="w-100 container py-2">
			<form id="search_form" action="/search" method="GET">
				<div class="form-inline">
					<div class="col-12 col-md-5">
						<div class="form-group">
							<div class="input-group w-100">
							  	<input type="text" class="form-control" id="location" name="location" value="<%= filters[5].query %>">
							  	<input type="hidden" id="query_city" name="query_city" value="<%= filters[6].query_city %>">
								<input type="hidden" id="query_lat" name="query_lat" value="<%= filters[7].query_lat %>">
								<input type="hidden" id="query_lng" name="query_lng" value="<%= filters[8].query_long %>">
							  	<div class="input-group-append">
							    	<button class="btn btn-danger" type="submit">Search</button>
							  	</div>
							</div>
						</div>
					</div>
					<div class="col-12 col-md-7">
						<div class="row">
							<div class="col-4">
								<div class="form-group">
									<div class="dropdown">
									  	<button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="dropdown">House Rules</button>
									  	<div class="dropdown-menu dropdown-menu-right p-4">
									   	 	<div class="pretty p-icon p-smooth p-bigger mb-3">
										        <input type="checkbox" name="smoking" id="smoking" <% if(filters[2].ruleFilter.dorm_smoking){ %> checked <% } %> />
										        <div class="state p-info">
										        	<i class="icon fa fa-check"></i>
										            <label>Smoking Allowed</label>
										        </div>
										    </div>
										    <div class="pretty p-icon p-smooth p-bigger mb-3">
										        <input type="checkbox" name="parties" id="parties"  <% if(filters[2].ruleFilter.dorm_parties){ %> checked <% } %>/>
										        <div class="state p-info">
										        	<i class="icon fa fa-check"></i>
										            <label>Parties or Events Allowed</label>
										        </div>
										    </div>
										    <div class="pretty p-icon p-smooth p-bigger">
										        <input type="checkbox" name="pets" id="pets"  <% if(filters[2].ruleFilter.dorm_pets){ %> checked <% } %>/>
										        <div class="state p-info">
										        	<i class="icon fa fa-check"></i>
										            <label>Pets Allowed</label>
										        </div>
										    </div>
										    <div class="form-group mt-2">
										    	<button class="btn btn-info btn-sm ml-auto sendform">Apply</button>
										    </div>
									  	</div>
									</div>
								</div>
							</div>
							<div class="col-4">
								<div class="form-group">
									<div class="dropdown">
									  	<button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="dropdown">Amenities</button>
									  	<div class="dropdown-menu p-4 dropdown-menu-larger dropdown-menu-right">
									  		<h6 class="title-bold">Basic Amenities</h6>
										  	<div class="row">
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="wifi" id="wifi" <% if(filters[1].amenityFilter.dorm_wifi){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>WiFi</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="closet" id="closet" <% if(filters[1].amenityFilter.dorm_closetdrawers){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Closet/Drawers</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="tv" id="tv" <% if(filters[1].amenityFilter.dorm_tv){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>TV</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="aircon" id="aircon" <% if(filters[1].amenityFilter.dorm_aircon){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Air Conditioning</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="iron" id="iron" <% if(filters[1].amenityFilter.dorm_iron){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Iron</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="kitchen" id="kitchen" <% if(filters[1].amenityFilter.dorm_kitchen){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Kitchen</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-6">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="washingmachine" id="washingmachine" <% if(filters[1].amenityFilter.dorm_washingmachine){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Washing Machine</label>
												        </div>
												    </div>
										  		</div>
										  	</div>
										  	<h6 class="title-bold">Security Amenities</h6>
										  	<div class="row mt-2">
										  		<div class="col-lg-12">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="fireext" id="fireext" <% if(filters[1].amenityFilter.dorm_fireext){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Fire Extinguisher</label>
												        </div>
												    </div>
										  		</div>
										  		<div class="col-lg-12">
										  			<div class="pretty p-icon p-smooth p-bigger mb-3">
												        <input type="checkbox" name="cctv" id="cctv" <% if(filters[1].amenityFilter.dorm_cctv){ %> checked <% } %>/>
												        <div class="state p-info">
												        	<i class="icon fa fa-check"></i>
												            <label>Security Cameras/CCTV</label>
												        </div>
												    </div>
										  		</div>
										  	</div>
											<div class="form-group mt-2">
											    <button class="btn btn-info btn-sm ml-auto">Apply</button>
											</div>
									  	</div>
									</div>
								</div>
							</div>
							<div class="col-4">
								<div class="form-group">
									<div class="dropdown">
										<button type="button" class="btn btn-outline-secondary btn-sm" data-toggle="dropdown">More Filters</button>
										<div class="dropdown-menu p-4 dropdown-menu-larger dropdown-menu-right">
											<h6 class="title-bold">Gender</h6>
											<div class="pretty p-default p-round p-bigger mb-3">
												<input type="radio" name="gender" value="For males" <% if(filters[4].filterDefault.dorm_gender === "For males"){ %> checked="checked" <% } %>>
												<div class="state p-info">
												    <label>Male</label>
												</div>
											</div>
											<div class="pretty p-default p-round p-bigger">
												<input type="radio" name="gender" value="For females" <% if(filters[0].dormFilter.dorm_gender === "For females"){ %> checked="checked" <% } %>>
												<div class="state p-info">
												    <label>Female</label>
												</div>
											</div>
											<div class="pretty p-default p-round p-bigger">
												<input type="radio" name="gender" value="For males and females" <% if(filters[0].dormFilter.dorm_gender === "For males and females"){ %> checked="checked" <% } %>>
												<div class="state p-info">
												    <label>Both</label>
												</div>
											</div>
											<hr>
											<h6 class="title-bold">Bathrooms</h6>
											<div class="form-group">
												<label id="bath-label" class="range-input">0 - 
													<% if(filters[3].otherFilter.bathroom){ %> 
														<%= filters[3].otherFilter.bathroom %> Bathrooms
													<% }else{ %>
														10 bathrooms
													<% } %>
												</label>
												<input type="hidden" name="bathrooms" id="bathrooms" value="<%= filters[3].otherFilter.bathroom %>">
											</div>
											<div id="slider-range-max"></div>
											<hr>
											<h6 class="title-bold">Average Rent per Month</h6>
											<div class="form-group">
												<label id="amount-label" class="range-input">										<% if(filters[3].otherFilter.toAverageAmount && filters[3].otherFilter.fromAverageAmount){ %> 
														<%= filters[3].otherFilter.fromAverageAmount + " PHP - " + filters[3].otherFilter.toAverageAmount %> PHP
													<% }else{ %>
														500 PHP - 10000 PHP
													<% } %>
												</label>
												<input type="hidden" name="fromAverageAmount" id="fromAverageAmount" value="<%= filters[3].otherFilter.fromAverageAmount %>">
												<input type="hidden" name="toAverageAmount" id="toAverageAmount" value="<%= filters[3].otherFilter.toAverageAmount %>">
											</div>
											<div id="slider-range-max-amount"></div>
											<hr>
											<div class="form-group mt-2">
											    <button class="btn btn-info btn-sm ml-auto">Apply</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class="search-body-container">
		<div class="search-body">
			<div class="row">
				<div class="col-md-8 col-sm-12 p-0">
					<h5 class="search-text-header center">Showing <%= lists.length %> of <%= numberofresults %> total dormitories found</h5>
				</div>
			</div>
			<div class="row">
				<div class="col-12 col-md-8">
					<div class="row">
						<% lists.forEach(function(dorm){ %>
							<div class="col-12 col-md-6 mb-4">
								<div id="<%= dorm.dorm_id %>" class="carousel slide" data-interval="false">
									<div class="carousel-inner corner-curved">
										<% var counter = 0;%>
									 	<% dorm.dorm_images.forEach(function(image){ %>
									 		<% if(counter < 1){ %>
											    <div class="carousel-item active">
											      	<img class="d-block w-100" src="/images/dorm_images/<%= image.image %>" style="max-height: 250px">
											    </div>
											    <% counter++; %>
											<% }else{ %>
												<div class="carousel-item">
											      	<img class="d-block w-100" src="/images/dorm_images/<%= image.image %>" style="max-height: 250px">
											    </div>
											<% } %>
										<% }); %>
									</div>
									<a class="carousel-control-prev" href="#<%= dorm.dorm_id %>" role="button" data-slide="prev">
									    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
									</a>
									<a class="carousel-control-next" href="#<%= dorm.dorm_id %>" role="button" data-slide="next">
									    <span class="carousel-control-next-icon" aria-hidden="true"></span>
									</a>
								</div>
								<a href="/listing/<%= dorm.dorm_id %>" target="_blank">
									<div class="card-body p-0 mt-2">
										<h6 class="search-text-title m-0"><%= dorm.dorm_name %></h6>
										<small class="block search-text"><i class="fas fa-map-marker-alt"></i> <%= dorm.address_dorm.dorm_complete_loc %></small>
										<small class="search-text"><i class="fa fa-user"></i> <%= dorm.roomslots[0].slots %>/<%=dorm.availableslots[0].allslots %> Slots Available</small>
										<hr class="m-1">
										<span class="search-text-footer">
											&#8369;<%= (Number(dorm.avgrent[0].avgrent)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,') %>	
										</span>
										<span class="search-text-footer">average rent a month</span>
										<div>
											<% var averagerating = 0 %>
											<% for(var i = 0; i < 5; i++){ %>
												<% if(i < dorm.averagerating[0].averagerating){ %>
													<% averagerating = dorm.averagerating[0].averagerating; %>
												  	<img src="/images/static/star-on.png" class="rating-listing">
												<% }else{ %>
													<img src="/images/static/star-off.png" class="rating-listing">
												<% } %>
											<% } %>
											<small class="search-text-footer"><%= Math.trunc(Math.floor(averagerating)) %> Stars - <%= dorm.countedreviews %> Reviews</small>
										</div>
									</div>
								</a>
							</div>
							<input type="hidden" class="long " data-id="<%= dorm.dorm_id %>" value="<%= dorm.address_dorm.dorm_long %>">
					    	<input type="hidden" class="lat" data-id="<%= dorm.dorm_id %>" value="<%= dorm.address_dorm.dorm_lat %>">
					    	<input type="hidden" class="dorm_name" data-id="<%= dorm.dorm_id %>" value="<%= dorm.dorm_name %>">
					    	<input type="hidden" class="dorm_price" data-id="<%= dorm.dorm_id %>" value="<%= dorm.avgrent[0].avgrent %>">
					    	<input type="hidden" class="dorm_image" data-id="<%= dorm.dorm_id %>" value="<%= dorm.dorm_images[0].image %>">
						<% }); %>
					</div>
				</div>
				<div class="col-12 col-md-4">
					<div id="map_search">
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="mt-3">
		<% if(pageCount > 1 ){ %>
	        <ul class="pagination justify-content-center">
	        	<% if(currentPage > 1){ %>
	        		<li class="page-item">
				      	<button class="page-link" value="<%= Number(currentPage) - 1; %>" aria-label="Previous">
				        	<span aria-hidden="true">&laquo;</span>
				      	</button>
				    </li>
	        	<% } %>
	        	<% for(var x = 1; x<= pageCount; x++){ %>
	        		<% if(currentPage == x){ %>
	        			<li class="page-item active"><button class="page-link"><%= currentPage %></button></li> 
	        		<% }else{ %>
	        			<li class="page-item"><button value="<%= x %>" class="page-link"><%= x %></button></li>
	        		<% } %>
	        		<% if(x == (currentPage + 4)){ %>
	        			<li disabled class="page-item"><button class="page-link"></button></li>
	        			<% break; %>
	        		<% } %>
	        	<% } %>
	        	<% if(currentPage != pageCount){ %>
	        		<li class="page-item">
				      	<button class="page-link" value="<%= Number(currentPage) + 1; %>" aria-label="Next">
				        	<span aria-hidden="true">&raquo;</span>
				      	</button>
				    </li>
	        	<% } %>
	        </ul>
	    <% } %>
	</div>

	<script type="text/javascript" src="/assets/search.js"></script>

	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAeqKaE2xSUv_iplHE5GK1baRKlwKyURrE&libraries=places&callback=activatePlacesSearch"></script>

<% include ../partials/footer %>